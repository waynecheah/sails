define(["./normalize"],function(a){function b(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}if("undefined"==typeof window)return{load:function(a,b,c){c()}};var c=!1,d=document.getElementsByTagName("head")[0],e=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),f=!1;e&&(e[1]||e[7]?(f=6>parseInt(e[1])||9>=parseInt(e[7]),e="trident"):e[2]?(f=!0,e="webkit"):e[3]||(e[4]?(f=18>parseInt(e[4]),e="gecko"):c&&alert("Engine detection failed")));var g={},h=/^\/|([^\:\/]*:)/;g.pluginBuilder="./css-builder";var i=[],j={},k=[];g.addBuffer=function(a){-1==b(i,a)&&-1==b(k,a)&&(i.push(a),k.push(a))},g.setBuffer=function(b,c){var d=window.location.pathname.split("/");d.pop(),d=d.join("/")+"/";var e=require.toUrl("base_url").split("/");e.pop();var f=e.join("/")+"/";f=a.convertURIBase(f,d,"/"),f.match(h)||(f="/"+f),"/"!=f.substr(f.length-1,1)&&(f+="/"),g.inject(a(b,f,d));for(var k=0;i.length>k;k++)(c&&".less"==i[k].substr(i[k].length-5,5)||!c&&".css"==i[k].substr(i[k].length-4,4))&&(function(a){j[a]=j[a]||!0,setTimeout(function(){"function"==typeof j[a]&&j[a](),delete j[a]},7)}(i[k]),i.splice(k--,1))},g.attachBuffer=function(a,c){for(var d=0;i.length>d;d++)if(i[d]==a)return j[a]=c,!0;return j[a]===!0?(j[a]=c,!0):-1!=b(k,a)?(c(),!0):void 0};var l=function(a,b){setTimeout(function(){for(var c=0;document.styleSheets.length>c;c++){var d=document.styleSheets[c];if(d.href==a.href)return b()}l(a,b)},10)},m=function(a,b){setTimeout(function(){try{return a.sheet.cssRules,b()}catch(c){}m(a,b)},10)};if("trident"==e&&f)var n=[],o=[],p=0,q=function(a,b){var c;o.push({url:a,cb:b}),c=n.shift(),!c&&12>p++&&(c=document.createElement("style"),d.appendChild(c)),r(c)},r=function(a){var b=o.shift();if(!b)return a.onload=t,n.push(a),void 0;a.onload=function(){b.cb(b.ss),r(a)};var c=a.styleSheet;b.ss=c.imports[c.addImport(b.url)]};var s=function(a){var b=document.createElement("link");return b.type="text/css",b.rel="stylesheet",b.href=a,b},t=function(){};g.linkLoad=function(a,b){var g=setTimeout(function(){c&&alert("timeout"),b()},1e3*C-100),h=function(){clearTimeout(g),i&&(i.onload=t),setTimeout(b,7)};if(f)if("webkit"==e){var i=s(a);l(i,h),d.appendChild(i)}else if("gecko"==e){var j=document.createElement("style");j.textContent='@import "'+a+'"',m(j,h),d.appendChild(j)}else"trident"==e&&q(a,h);else{var i=s(a);i.onload=h,d.appendChild(i)}};var y,u=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],v={},w=function(a,b,c){if(v[a])return b(v[a]),void 0;var d,e,f;if("undefined"!=typeof XMLHttpRequest)d=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(e=0;3>e;e+=1){f=u[e];try{d=new ActiveXObject(f)}catch(g){}if(d){u=[f];break}}d.open("GET",a,requirejs.inlineRequire?!1:!0),d.onreadystatechange=function(){var f,g;4===d.readyState&&(f=d.status,f>399&&600>f?(g=Error(a+" HTTP status: "+f),g.xhr=d,c(g)):(v[a]=d.responseText,b(d.responseText)))},d.send(null)},x=0;g.inject=function(a){31>x&&(y=document.createElement("style"),y.type="text/css",d.appendChild(y),x++),y.styleSheet?y.styleSheet.cssText+=a:y.appendChild(document.createTextNode(a))};var z=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,A=window.location.pathname.split("/");A.pop(),A=A.join("/")+"/";var B=function(b,c,d){b.match(h)||(b="/"+a.convertURIBase(b,A,"/")),w(b,function(e){e=a(e,b,A);for(var i,f=[],g=[],h=[];i=z.exec(e);){var j=i[4]||i[5]||i[7]||i[8]||i[9];f.push(j),g.push(z.lastIndex-i[0].length),h.push(i[0].length)}for(var k=0,l=0;f.length>l;l++)(function(a){B(f[a],function(b){e=e.substr(0,g[a])+b+e.substr(g[a]+h[a]);for(var d=b.length-h[a],i=a+1;f.length>i;i++)g[i]+=d;k++,k==f.length&&c(e)},d)})(l);0==f.length&&c(e)},d)};g.normalize=function(a,b){return".css"==a.substr(a.length-4,4)&&(a=a.substr(0,a.length-4)),b(a)};var C,D=!1;return g.load=function(a,b,d,e,h){C=C||e.waitSeconds||7;var i=a+(h?".less":".css");g.attachBuffer(i,d)||(fileUrl=b.toUrl(i),!D&&c&&(alert(f?"hacking links":"not hacking"),D=!0),h?B(fileUrl,function(a){h&&(a=h(a,function(a){g.inject(a),setTimeout(d,7)}))}):g.linkLoad(fileUrl,d))},c&&(g.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0}),g});